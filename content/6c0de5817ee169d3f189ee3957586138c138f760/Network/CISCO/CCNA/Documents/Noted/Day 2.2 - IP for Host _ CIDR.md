Bài tập: 172.16.128.0/20 chia thành 7 lớp mạng, lấy lớp mạng thứ 3
Sau khi có IP tổng quát của lớp mạng thứ 3, sẽ quy hoạch cho các phòng ban như sau.
Phòng A: 10
Phòng B: 200
Phòng C: 100
Phòng D: 50

172.16.128.0/20
n = 3 -> bước nhảy = 2
IP tổng quát: 172.16.132.0/23 (lớp mạng thứ 3)

Phòng B: 
m = 8 
IP tổng quát: 172.16.132.0/24

Phòng C:
m = 7
IP tổng quát: 172.16.132.0/25

Phòng D:
m = 6
IP tổng quát: 172.16.132.0/26

Phòng A:
m = 4
IP tổng quát: 172.16.132.0/28

Giải:
Phần A: chia Subnet (mượn bit - chiều từ trái phải)
172.16.128.0/20 chia thành 7 lớp mạng: 
Số bit mượn: 2^n >= 7 ---> n = 3 (mượn 3 bit)
Mượn 3 bit = abc
c là Magic number -> bước nhảy = 2
128	64	32	16	8	4	2	1
1	0	0	0	a	b	c
				
/20 ở Octet thứ 3 nên sẽ phân tích nhị phân ở Octet này
		172.16.1000 |0000.0000 0000/20
mượn 3 bit:	172.16.1000  abc|x.xxxx xxxx/23
(dời về bên phải 3 bit -> /23)
Lấy lớp mạng thứ 3 -> abc = 010
		172.16.1000  010x.xxxx xxxx/23
128	64	32	16	8	4	2	1
1	0	0	0	0	1	0		
IP tổng quát: 172.16.132.0/23 của lớp mạng thứ 3
Subnet Mask:  255.255.254.0
IP Net(x=0)	 : 172.16.132.0
IP Broadcast(x=1): 172.16.133.255
IP Host		 : 172.16.132.1 -> 172.16.133.254

Phần B: chia số Hosts 
1. Cần số bit - chiều phải sang trái
2. Sắp xếp thứ tự - chiều từ trên xuống theo giá trị giảm dần.

B1: Sắp xếp thứ tự từ lớn -> nhỏ: B - C - D - A
Phòng B: có 200 hosts
2^m - 2 >= 200 ---> m = 8
Cần 8 bit để làm Host cho phòng B
8 bit là lấy hết của Octet thứ 4, nên sẽ phân tích Octet thứ 3

		172.16.132.0/23
		172.16.1000 0100.0000 0000/23
Cần 8 bit:	172.16.1000 0100.xxxx xxxx/24	(32 - 8 bit cần làm host = 24)
IP Tổng quát:   172.16.132.0/24
Subnet Mask : 	255.255.255.0

IP Net(x=0)	 : 172.16.132.0
IP Broadcast(x=1): 172.16.132.255
IP Host		 : 172.16.132.1 - 172.16.132.254

Có 2 cách để tính lớp mạng tiếp theo:
Tính nhanh: 172.16.1000 0100.xxxx xxxx/24
		   1000 0101
Tính chậm: IP Broadcast + 1
		172.16.132.255 + 1
		172.16.1000 0100.1111 1111
	+				 1
		--------------------------
		172.16.1000 0101.0000 0000
Lớp mạng tiếp theo sau phòng B 	
		172.16.133.0
Phòng C: có 100 hosts -> 2^m - 2 >= 100
m = 7 -> cần 7 bit làm host
7 bit thuộc Octet thứ 4 -> phân tích nhị phân ở Octet thứ 4 này
		172.16.133.0000 0000
cần 7 bit	172.16.133.0xxx xxxx/25

IP tổng quát: 	172.16.133.0/25
Subnetmask:	255.255.255.128

IP Net: 	172.16.133.0
IP Broadcast:	172.16.133.127
IP Host:	172.16.133.1 - 172.16.133.126

Lớp mạng tiếp theo sau phòng C: 172.16.133.127 + 1
		172.16.133.0111 1111 
	+		           1
		--------------------		
		172.16.133.1000 0000
		172.16.133.128

Phòng D: có 50 host -> 2^m - 2 >= 50
m = 6 -> cần 6 bits làm host
		172.16.133.1000 0000
cần 6 bit	172.16.133.10xx xxxx/26
IP tổng quát:	172.16.133.128/26
Subnet Mask:	255.255.255.192

IP Net: 	172.16.133.128
IP Broadcast:	172.16.133.191
IP Host:	172.16.133.129 - 172.16.133.190

Lớp mạng tiếp theo sau phòng D: 172.16.133.191 + 1
		172.16.133.1011 1111 
	+		           1
		--------------------
		172.16.133.1100 0000
		172.16.133.192

Phòng A: có 10 host -> 2^m - 2 >= 10
m = 4 -> cần 4 bit làm host
		172.16.133.1100 0000
cần 4 bit	172.16.133.1100 xxxx/28
IP tổng quát: 	172.16.133.192/28
Subnet Mask:	255.255.255.240

IP Net: 	172.16.133.192
IP Broadcast:   172.16.133.207
IP Host:	172.16.133.193 - 172.16.133.206


VD: 172.16.0.0/18 chia thành 3 lớp mạng -> lấy lớp mạng đầu tiên
Có 4 phòng:
Phòng A: 200 -> /24
Phòng B: 500 -> /23
Phòng C: 100 -> /25
Phòng D: 200 -> /24

172.16.0.0/18 chia thành 3 lớp mạng: 2^n >= 3
n = 2 
mượn 2 bit -> ab
128	64	32	16	8	4	2	1
0       0	a	b
b là Magic number -> bước nhảy = 16
Lớp mạng đầu tiên -> ab = 00

IP tổng quát:	172.16.0.0/20
SM:		255.255.240.0

IP Net: 	172.16.0.0
IP Broadcast: 	172.16.15.255
IP Host:	172.16.0.1 - 172.16.15.254

Suy luận trước khi làm chia Host:
172.16.0.0 - 172.16.0.255
172.16.1.0 - 172.16.1.255
...
172.16.15.0 - 172.16.15.255

có 16 lớp mạng /24

1 lớp /24 - có 256 host
2 lớp /24 - có 512 host -> /23
1/2 lớp /24 - có 128 host


172.16.0.0 - 172.16.0.255
172.16.1.0 - 172.16.1.255

Phòng B: 172.16.0.0/23 ~ (172.16.0.0/24 & 172.16.1.0/24)
Phòng A: 172.16.2.0/24
Phòng D: 172.16.3.0/24
Phòng C: 172.16.4.0/25

Sắp xếp theo thứ tự từ lớn -> nhỏ: B - A - D - C (hoặc B - D - A - C) do phòng A và phòng D số lượng host bằng nhau
Phòng B: có 500 host -> 2^m - 2 >= 500
-> m = 9 (cần 9 bit làm host)

		172.16.0000 0000.0000 0000/20
cần 9 bit	172.16.0000 000x.xxxx xxxx/23
IP tổng quát:	172.16.0.0/23
SM:		255.255.254.0

IP Net: 	172.16.0.0
IP Broadcast:	172.16.1.255
IP Host:	172.16.0.1 - 172.16.1.254

Lớp mạng tiếp theo sau Phòng B: 172.16.1.255 + 1 = 172.16.2.0

Phòng A: có 200 host -> 2^m - 2 >= 200
-> m = 8 (cần 8 bit làm host)

		172.16.0000 0010.0000 0000
cần 8 bit 	172.16.0000 0010.xxxx xxxx/24
IP tổng quát	172.16.2.0/24
SM		255.255.255.0

IP NeT: 	172.16.2.0
IP Broadcasr:	172.16.2.255
IP Host:	172.16.2.1 - 172.16.2.255
Lớp mạng tiếp theo sau Phòng A: 172.16.2.255 + 1 = 172.16.3.0

Phòng D: có 200 host -> 2^m - 2 >= 200
-> m = 8 (cần 8 bit làm host)

		172.16.0000 0011.0000 0000
cần 8 bit 	172.16.0000 0011.xxxx xxxx/24
IP tổng quát:	172.16.3.0/24
SM:		255.255.255.0

IP Net: 	172.16.3.0
IP Broadcast:	172.16.3.255
IP HosT:	172.16.3.1 - 172.16.3.254
Lớp mạng tiếp theo sau Phòng D: 172.16.3.255 + 1 = 172.16.4.0

Phòng C: có 100 host -> 2^m - 2 >= 100
-> m = 7 (cần 7 bit làm host)

		172.16.0000 0100.0000 0000
cần 7 bit	172.16.0000 0100.0xxx xxxx/25
IP tổng quát:	172.16.4.0/25
SM:		255.255.255.128

IP net:		172.16.4.0
IP Broadcast:	172.16.4.127
IP host:	172.16.4.1 - 172.16.4.126


Summarization Subnet/IP: CIDR
Ví dụ: 192.168.1.1 - 192.168.1.7 viết 7 dòng
192.168.1.1
192.168.1.2
...
192.168.1.7

VD: 192.168.1.1 - 192.168.1.128 viết 127 dòng

CIDR định nghĩa: bit giống nhau sẽ giữ nguyên, bit khác nhau sẽ cho bằng x

192.168.1.0 - 192.168.1.3
192.168.1.0000 0000
192.168.1.0000 0001
192.168.1.0000 0010
192.168.1.0000 0011

VD1:
192.168.1.0000 0000/32
192.168.1.0000 0001/32
192.168.1.0000 0010/32
192.168.1.0000 0011/32

192.168.1.0000 00xx/30

192.168.1.0/30
192.168.1.0 - 192.168.1.3

VD2:
192.168.1.0 - 192.168.1.255
192.168.1.0000 0000/32
192.168.1.0000 0001/32
...
192.168.1.1111 1110/32
192.168.1.1111 1111/32
-------------------
192.168.1.xxxx xxxx/24

1 host ~ 2^0
1 bit  ~ 2^1 = 2 giá trị
2 bits ~ 2^2 = 4 giá trị

0 ~ 2^0
1 ~ 2^0

0-1 summary lại ~ 2^1

x ~ 1 bit (2^1 = 2 giá trị)
x = 0 -> 0
x = 1 -> 1

xx ~ 2 bit (2^2 = 4 giá trị)
00
01

10
11

xxx ~ 3 bit (2^3 = 8 giá trị)
000
001
010
011

100
101
110
111

xxxx ~ 4 bit (2^4 = 16 giá trị)
0000:0
0001
0010
0011
0100
0101
0110
0111

1000
1001
1010
1011
1100
1101
1110
1111:15


0000:0
0001
...
1110
1111:15

/24
0xxx xxxx: 0 - 127/25

1xxx xxxx: 128 - 255/25


VD: 192.168.1.1 - 192.168.1.3
192.168.1.1
192.168.1.2
192.168.1.3

1: 01 
2: 10
3: 11
   1x
192.168.1.1/32
192.168.1.2/31

192.168.1.2/31 ~ (192.168.1.2 & 192.168.1.3)


VD: 192.168.1.0 - 192.168.1.3
2 dòng ||
1 dòng |

00
01
 x 192.168.0.0/31
10
11
 x 192.168.0.2/31

xx 192.168.0.0/30

0-3 -> 2 bit -> xx -> 192.168.0.0/30

VD: 192.168.1.0 - 192.168.1.4
2 dòng |||

0-3 
4

011:3
100:4

0 - 1 - 3 - 7 - 15 - 31 - 63 - 127 - 255

Quy tắc: Net(chẵn) -> Broadcast(lẻ)

VD: 192.168.1.1 - 192.168.1.6
4 dòng
3 dòng

1		001

2-3		010
		011
		01x
		
4		100
5		101	
		  x
		  
6		110


1 	hệ 1 bit
10 	hệ 2 bit

11  hệ 2 bit
100	hệ 3 bit

101
110

VD: 192.168.1.0 - 192.168.1.9
0000: 0
0001: 1
0010: 2
0011: 3
0100: 4
0101: 5
0110: 6
0111: 7
0xxx

0-7

1000: 8
1001: 9
100x

8-9


VD: 192.168.1.1 - 192.168.1.9

0001: 1		1

0010: 2		2-3
0011: 3

0100: 4		4-7
0101: 5
0110: 6
0111: 7

1000: 8		8-9
1001: 9


VD: 192.168.1.0 - 192.168.1.15


0 bit: 1 giá trị 0/1

1 bit: 2 phần của 1 giá trị
0
1

2 bit: 2 phần của 1 bit
00
01
10
11

3 bit: 2 phần của 2 bit
000
001
010
011

100
101
110
111

4 bit: 2 phần 3 bit
0000
0001
0010
0011
0100
0101
0110
0111

1000
1001
1010
1011
1100
1101
1110
1111

5 bit: 2 phần của 4 bit
00000:0
00001
00010
00011
00100
00101
00110
00111
01000
01001
01010
01011
01100
01101
01110
01111: 15

10000: 16
10001
10010
10011
10100
10101
10110
10111
11000
11001
11010
11011
11100
11101
11110
11111: 31


VD: 192.168.1.0 - 192.168.1.15
	192.168.1.1 - 192.168.1.15

192.168.1.0 - 192.168.1.15 
0 - 15 (4 bits)
192.168.1.0/28

192.168.1.1 - 192.168.1.15
1	2^0
2-3	2^1	
4-7	2^2
8-15	2^3

VD: 	192.168.1.1 - 192.168.1.62
	192.168.1.0 - 192.168.1.63
	192.168.1.1 - 192.168.1.63

192.168.1.1 - 192.168.1.62
1	2^0  Phần của 0
2-3	2^1  Phần của 0
4-7	2^2  Phần của 0
8-15	2^3  Phần của 0
16-31	2^4  Phần của 0

32-47	2^4  Phần của 1
48-55	2^3  Phần của 1
56-59	2^2  Phần của 1
60-61	2^1  Phần của 1
62	2^0  Phần của 1

192.168.1.0 - 192.168.1.63
0-63		2^6

192.168.1.1 - 192.168.1.63
1		2^0
2-3		2^1
4-7		2^2
8-15		2^3
16-31		2^4
32-63		2^5

VD: 	192.168.1.1 - 192.168.1.254
	192.168.1.1 - 192.168.1.255
	192.168.1.0 - 192.168.1.254

192.168.1.1 - 192.168.1.254
1       2^0    0000 0001: 1
2-3     2^1    0
4-7     2^2    0
8-15    2^3    0
16-31   2^4    0
32-63   2^5    0
64-127	2^6    0111 1111: 127

128-191	2^6    1
192-223 2^5    1
224-239 2^4    1
240-247 2^3    1
248-251 2^2    1
252-253 2^1    1111 1110: 254
254	2^0 do sai quy luật (chẵn -> lẻ)


192.168.1.1 - 192.168.1.255: 255 là 8 bit, không summary được 8 bit nên chỉ summary tối đa 7 bit
1       	2^0    0000 0001: 1
2-3     	2^1    0
4-7     	2^2    0
8-15    	2^3    0
16-31   	2^4    0
32-63   	2^5    0
64-127		2^6    0111 1111: 127

128-255 	2^7	  

192.168.1.0 - 192.168.1.254
0-127		2^7

128-191		2^6
192-223		2^5
224-239		2^4
240-247		2^3
248-251		2^2
252-253		2^1
254		2^0





	

